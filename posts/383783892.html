<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="description" content="Just a blog."><meta name="keywords" content=""><link rel="stylesheet" href="/css/prism.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><title>使用jest+enzyme测试react组件 - zWing</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6650629ba7ddbfe98e2f63700c2e6923";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body><canvas id="ribbon"></canvas><main class="main"><header class="header"><a class="logo" href="/">zWing</a><nav class="menu"><a href="/archives/">Archives</a><a href="/tags/">Tags</a><a href="/about/">About</a><a href="/repo/">Repo</a></nav><div class="social"><a target="_blank" href="/rss.xml"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.18,15.64A2.18,2.18 0 0,1 8.36,17.82C8.36,19 7.38,20 6.18,20C5,20 4,19 4,17.82A2.18,2.18 0 0,1 6.18,15.64M4,4.44A15.56,15.56 0 0,1 19.56,20H16.73A12.73,12.73 0 0,0 4,7.27V4.44M4,10.1A9.9,9.9 0 0,1 13.9,20H11.07A7.07,7.07 0 0,0 4,12.93V10.1Z"></path></svg> </a><a target="_blank" href="https://github.com/zWingz/my-blog-config/issues"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path></svg></a></div></header><div class="content-container center"><div id="post" class="flex"><aside class="toc"><div class="stay"><ul><li><a href="#%E5%89%8D%E8%A8%80">前言</a></li><li><a href="#%E4%BE%9D%E8%B5%96">依赖</a><ul><li><a href="#%E5%BF%85%E8%A6%81%E4%BE%9D%E8%B5%96">必要依赖</a></li><li><a href="#%E6%8C%89%E9%9C%80">按需</a></li></ul></li><li><a href="#jest-%E9%85%8D%E7%BD%AE">Jest 配置</a><ul><li><a href="#modulenamemapper">moduleNameMapper</a></li><li><a href="#setupfilesafterenv">setupFilesAfterEnv</a></li><li><a href="#collectcoveragefrom">collectCoverageFrom</a></li><li><a href="#coveragedirectory">coverageDirectory</a></li><li><a href="#transform">transform</a></li><li><a href="#testmatch">testMatch</a></li></ul></li><li><a href="#enzyme-%E4%BD%BF%E7%94%A8">Enzyme 使用</a><ul><li><a href="#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D">简单介绍</a></li><li><a href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">基本使用</a></li></ul></li><li><a href="#%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95">进行测试</a></li><li><a href="#%E4%B8%8A%E4%BC%A0%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87">上传测试覆盖率</a></li><li><a href="#%E5%AE%8C%E7%BB%93">完结</a></li></ul><span class="toc-icon"></span></div></aside><article class="post-content"><time class="time">November 23, 2018</time><h1 class="title">使用jest+enzyme测试react组件</h1><div><a href="/tags/819211154" class="tags-item" style="background: #92efc8;">Front End </a><a href="/tags/989715361" class="tags-item" style="background: #a6c613;">React</a></div><div class="content"><h2 id="前言" class="heading"><a href="#%E5%89%8D%E8%A8%80" aria-hidden="true"><span class="icon icon-link"></span></a>前言</h2><p>最近第一次给一个项目写一个完整的测试流程, 也算是我第一次写完整的测试.</p><p>于是记一下整个测试流程</p><p><a href="https://github.com/zWingz/react-image">项目地址</a></p><p>目前项目使用的测试框架是主流的<code class="language-text">jest</code>+<code class="language-text">enzyme</code></p><h2 id="依赖" class="heading"><a href="#%E4%BE%9D%E8%B5%96" aria-hidden="true"><span class="icon icon-link"></span></a>依赖</h2><h3 id="必要依赖" class="heading"><a href="#%E5%BF%85%E8%A6%81%E4%BE%9D%E8%B5%96" aria-hidden="true"><span class="icon icon-link"></span></a>必要依赖</h3><ul><li>Jest</li><li>enzyme</li><li>enzyme-adapter-react-16</li></ul><h3 id="按需" class="heading"><a href="#%E6%8C%89%E9%9C%80" aria-hidden="true"><span class="icon icon-link"></span></a>按需</h3><ul><li>如果使用<code class="language-text">babel</code>，则需要<code class="language-text">babel-jest</code></li><li>如果使用<code class="language-text">typescript</code>， 则需要<code class="language-text">ts-jest</code></li><li>如果需要<code class="language-text">snapshot</code>, 则需要 <code class="language-text">enzyme-to-json</code></li></ul><h2 id="jest-配置" class="heading"><a href="#jest-%E9%85%8D%E7%BD%AE" aria-hidden="true"><span class="icon icon-link"></span></a>Jest 配置</h2><p>起初项目使用<code class="language-text">babel</code>进行编译，后面统一转成了<code class="language-text">ts</code></p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"jest"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"moduleNameMapper"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|scss)$"</span><span class="token operator">:</span> <span class="token string">"&lt;rootDir>/test/utils.ts"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 将静态资源匹配到utils.ts中</span>
    <span class="token property">"moduleFileExtensions"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"ts"</span><span class="token punctuation">,</span> <span class="token string">"tsx"</span><span class="token punctuation">,</span> <span class="token string">"js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"setupFilesAfterEnv"</span><span class="token operator">:</span> <span class="token string">"&lt;rootDir>/test/setup.ts"</span><span class="token punctuation">,</span> <span class="token comment">// jest环境初始化</span>
    <span class="token property">"collectCoverageFrom"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/**/*.{ts,tsx}"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 覆盖率收集</span>
    <span class="token property">"coverageDirectory"</span><span class="token operator">:</span> <span class="token string">"./coverage/"</span><span class="token punctuation">,</span> <span class="token comment">// 覆盖率输出目录</span>
    <span class="token property">"collectCoverage"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"transform"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"^.+\\.(ts|tsx)$"</span><span class="token operator">:</span> <span class="token string">"ts-jest"</span> <span class="token comment">// 如果是babel, 则为babel-jest</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"testMatch"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"**/__test__/*.(ts|tsx)"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"snapshotSerializers"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"enzyme-to-json/serializer"</span> <span class="token comment">// 用来适配 toMatchSnapshot</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果使用<code class="language-text">babel</code>的话, 只要将<code class="language-text">ts</code>转成<code class="language-text">js</code>, <code class="language-text">ts-jest</code>转成<code class="language-text">babel-jest</code>即可。</p><h3 id="modulenamemapper" class="heading"><a href="#modulenamemapper" aria-hidden="true"><span class="icon icon-link"></span></a>moduleNameMapper</h3><p>用来<code class="language-text">mock</code>一些额外<code class="language-text">module</code>, 比如<code class="language-text">sass</code>, <code class="language-text">jpg</code>等等.</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// /test/utils.ts</span>
<span class="token keyword">module</span><span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">'test-file-stub'</span>
</code></pre></div><h3 id="setupfilesafterenv" class="heading"><a href="#setupfilesafterenv" aria-hidden="true"><span class="icon icon-link"></span></a>setupFilesAfterEnv</h3><blockquote><p>The path to a module that runs some code to configure or set up the testing framework before each test.</p></blockquote><p>可以用来初始化<code class="language-text">test</code>配置, 在这里需要使用<code class="language-text">enzyme-adapter</code></p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// /test/setup.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> configure <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'enzyme'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ReactSixteenAdapter <span class="token keyword">from</span> <span class="token string">'enzyme-adapter-react-16'</span>

<span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span> adapter<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ReactSixteenAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="collectcoveragefrom" class="heading"><a href="#collectcoveragefrom" aria-hidden="true"><span class="icon icon-link"></span></a>collectCoverageFrom</h3><p>需要测试覆盖率的文件</p><h3 id="coveragedirectory" class="heading"><a href="#coveragedirectory" aria-hidden="true"><span class="icon icon-link"></span></a>coverageDirectory</h3><p>覆盖率输出目录</p><h3 id="transform" class="heading"><a href="#transform" aria-hidden="true"><span class="icon icon-link"></span></a>transform</h3><blockquote><p>A map from regular expressions to paths to transformers. A transformer is a module that provides a synchronous function for transforming source files</p></blockquote><p>跟<code class="language-text">webpack-loader</code>类似</p><h3 id="testmatch" class="heading"><a href="#testmatch" aria-hidden="true"><span class="icon icon-link"></span></a>testMatch</h3><blockquote><p>The glob patterns Jest uses to detect test files.</p></blockquote><p>测试文件匹配规则, 如果跟官方不同, 则修改此值.</p><h2 id="enzyme-使用" class="heading"><a href="#enzyme-%E4%BD%BF%E7%94%A8" aria-hidden="true"><span class="icon icon-link"></span></a>Enzyme 使用</h2><p><a href="https://airbnb.io/enzyme/">官方文档</a></p><h3 id="简单介绍" class="heading"><a href="#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D" aria-hidden="true"><span class="icon icon-link"></span></a>简单介绍</h3><p>其实<code class="language-text">enzyme</code>上手挺简单的, 它有三个<code class="language-text">API</code></p><p>包括<code class="language-text">shallow</code>、<code class="language-text">mount</code>和<code class="language-text">render</code>, 其中<code class="language-text">shallow</code>和<code class="language-text">mount</code>是常用的</p><p>他们区别是</p><ul><li><code class="language-text">shallow</code>: 只会渲染顶级组件, 而子组件不会渲染, 渲染结果是一颗<code class="language-text">react</code>树, 效率最高</li><li><code class="language-text">mount</code>: 会渲染整个组件, 包括子组件, 如果需要深入组件内部测试, 则需要使用<code class="language-text">mount</code></li><li><code class="language-text">render</code>: 直接选择普通的<code class="language-text">html</code>结构.</li></ul><p><code class="language-text">shallow</code>和<code class="language-text">mount</code>得到结果是一个<code class="language-text">ReactWrapper</code>对象, 可以进行多种操作, 包括<code class="language-text">find()</code>、<code class="language-text">prop()</code>、<code class="language-text">instance()</code>等。</p><h3 id="基本使用" class="heading"><a href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8" aria-hidden="true"><span class="icon icon-link"></span></a>基本使用</h3><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallow<span class="token punctuation">,</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'enzyme'</span>
<span class="token keyword">import</span> MyComponent <span class="token keyword">from</span> <span class="token string">'../MyComponent'</span>
<span class="token keyword">import</span> ChildComponent <span class="token keyword">from</span> <span class="token string">'../ChildComponent'</span>

<span class="token function">describt</span><span class="token punctuation">(</span><span class="token string">'测试xxxxx'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'组件state以及渲染情况'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallow</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>MyComponent <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'test msg'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'#childId'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveLength</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 测试是否包含某个`element`</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>ChildComponent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveLength</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 测试是否包含某个子组件</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'触发事件'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> click <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallow</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>MyComponent onClick<span class="token operator">=</span><span class="token punctuation">{</span>click<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span>
    <span class="token comment">// 触发#triggerClickElement的click事件</span>
    wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'#triggerClickElement'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">simulate</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token comment">// 判断click事件是否被触发</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>click<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 测试函数调用</span>
  <span class="token comment">// 默认该函数声明方式通过class.method声明</span>
  <span class="token comment">// class MyComponent{</span>
  <span class="token comment">//   someMethod() {}</span>
  <span class="token comment">// }</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'测试函数调用'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span><span class="token class-name">MyComponent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'someMethod'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallow</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>MyComponent <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span>
    <span class="token comment">// 暂且认为组件挂载时会调用`someMethod`</span>
    <span class="token comment">// 在此测试是否正确调用</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 但是由于react需要绑定this</span>
  <span class="token comment">// 所以一般会这样声明</span>
  <span class="token comment">// class MyComponent {</span>
  <span class="token comment">//   someMethod = () => {}</span>
  <span class="token comment">// }</span>
  <span class="token comment">// 这时候通过babel或者typescript编译后</span>
  <span class="token comment">// 会变成类似</span>
  <span class="token comment">// class MyComponent{</span>
  <span class="token comment">//   constructor() {</span>
  <span class="token comment">//     this.someMethod = () => {}</span>
  <span class="token comment">//   }</span>
  <span class="token comment">// }</span>
  <span class="token comment">// 这时候someMethod不属于MyComponent.prototype</span>
  <span class="token comment">// 所以要改变测试方式</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'测试函数调用'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallow</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>MyComponent <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> ins <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>ins<span class="token punctuation">,</span> <span class="token string">'someMethod'</span><span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    ins<span class="token punctuation">.</span><span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'触发特定事件, 并传递参数'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果要触发特定事件, 比如mousemove, keyup等等</span>
    <span class="token comment">// 可以通过构造自定义事件, 并且使用dispatchEvent来触发</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallow</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>MyComponent <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> element <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.some-element'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MouseEvent</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      clientX<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      clientY<span class="token punctuation">:</span> <span class="token number">100</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    element<span class="token punctuation">.</span><span class="token function">getDOMNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>state<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqueal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>其实<code class="language-text">enzyme</code>常用的api大概就是几个, 按照本项目中用到的,</p><ul><li>state</li><li>find</li><li>prop</li><li>simulate</li></ul><h2 id="进行测试" class="heading"><a href="#%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95" aria-hidden="true"><span class="icon icon-link"></span></a>进行测试</h2><p>编写完<code class="language-text">test case</code>后, 只要调用<code class="language-text">jest</code>即可进行测试, 同时会输出覆盖率</p><p>如果带上<code class="language-text">--watch</code>则可以监听文件改动并进行测试</p><h2 id="上传测试覆盖率" class="heading"><a href="#%E4%B8%8A%E4%BC%A0%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87" aria-hidden="true"><span class="icon icon-link"></span></a>上传测试覆盖率</h2><p>目前使用<code class="language-text">Codecov</code>来管理测试覆盖率</p><p>如果在本地上传, 则需要带上<code class="language-text">token</code>, 如果通过<code class="language-text">travisCi</code>, 则不需要, 直接调用<code class="language-text">codecov</code>即可。</p><h2 id="完结" class="heading"><a href="#%E5%AE%8C%E7%BB%93" aria-hidden="true"><span class="icon icon-link"></span></a>完结</h2><p>至此， 整套<code class="language-text">jest</code>+<code class="language-text">enzyme</code>测试流程已经跑完.</p><p>目前看来没有用高更深的测试功能, 比如说<code class="language-text">jsdom</code>, <code class="language-text">enzyme.render</code>等</p></div><div class="comments"><div id="gitalk-container"></div></div></article></div></div></main><footer class="footer"><div class="center">Powered by <a target="_blank" href="https://github.com/acyortjs/acyort">AcyOrt</a> / Theme <a target="_blank" href="https://github.com/acyortjs/theme-donob">donob</a></div></footer><script src="/script/post.js"></script><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script>const gitalkConfig = JSON.parse('{"owner":"zWingz","repo":"my-blog-config","admin":["zWingz"],"clientID":"0438ed96c0cb944693a7","clientSecret":"23e7aa3152f5d03d8f20029540741d6f886c9f5b","number":20}')
  var gitalk = new Gitalk({
    ...gitalkConfig
  })
  gitalk.render('gitalk-container')</script><script defer="defer" src="/script/ribbon.js"></script></body></html>