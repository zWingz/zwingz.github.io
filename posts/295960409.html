<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="description" content="Just a blog."><link rel="stylesheet" href="/css/prism.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><title>vue组件-固定表格 - zWing</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6650629ba7ddbfe98e2f63700c2e6923";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body><canvas id="ribbon"></canvas><main class="main"><header class="header"><a class="logo" href="/">zWing</a><nav class="menu"><a href="/archives/">Archives</a><a href="/tags/">Tags</a><a href="/about/">About</a><a href="/repo/">Repo</a></nav><div class="social"><a target="_blank" href="/rss.xml"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.18,15.64A2.18,2.18 0 0,1 8.36,17.82C8.36,19 7.38,20 6.18,20C5,20 4,19 4,17.82A2.18,2.18 0 0,1 6.18,15.64M4,4.44A15.56,15.56 0 0,1 19.56,20H16.73A12.73,12.73 0 0,0 4,7.27V4.44M4,10.1A9.9,9.9 0 0,1 13.9,20H11.07A7.07,7.07 0 0,0 4,12.93V10.1Z"></path></svg> </a><a target="_blank" href="https://github.com/zWingz/my-blog-config/issues"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path></svg></a></div></header><div class="content-container center"><div id="post" class="flex"><aside class="toc"><div class="stay"><ul><li><a href="#%E5%9B%BA%E5%AE%9A%E8%A1%A8%E6%A0%BC">固定表格</a><ul><li><a href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">实现原理</a><ul><li><a href="#%E7%BB%9D%E5%AF%B9%E5%AE%9A%E4%BD%8D">绝对定位</a></li></ul></li><li><a href="#css-%E6%96%B9%E6%B3%95---position-sticky">css 方法 - position: sticky</a></li><li><a href="#%E6%9C%AC%E6%96%87%E5%AE%9E%E7%8E%B0">本文实现</a><ul><li><a href="#%E8%83%8C%E6%99%AF">背景</a></li><li><a href="#%E7%AC%AC%E4%B8%80%E7%89%88">第一版</a></li><li><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7%E9%97%AE%E9%A2%98">兼容性问题</a></li><li><a href="#%E7%AC%AC%E4%BA%8C%E7%89%88">第二版</a></li><li><a href="#%E7%AC%AC%E4%B8%89%E7%89%88">第三版</a></li><li><a href="#%E6%80%9D%E8%80%83%E6%94%B9%E8%BF%9B">思考改进</a></li><li><a href="#%E7%AC%AC%E5%9B%9B%E7%89%88">第四版</a></li><li><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95">实现方法</a></li><li><a href="#%E4%B8%8D%E8%B6%B3%E4%B9%8B%E5%A4%84">不足之处</a></li><li><a href="#aligncell-%E6%98%AF%E4%BB%80%E4%B9%88-">AlignCell 是什么 ?</a></li></ul></li><li><a href="#%E7%BB%93%E8%AF%AD">结语</a></li><li><a href="#%E6%94%BE%E5%81%87%E4%BA%86-%E8%BF%87%E5%B9%B4%E4%BA%86">放假了, 过年了</a></li></ul></li></ul><span class="toc-icon"></span></div></aside><article class="post-content"><time class="time">February 09, 2018</time><h1 class="title">vue组件-固定表格</h1><div><a href="/tags/819211154" class="tags-item" style="background: #92efc8;">Front End </a><a href="/tags/819211105" class="tags-item" style="background: #dd4970;">Vue</a></div><div class="content"><h1 id="固定表格" class="heading"><a href="#%E5%9B%BA%E5%AE%9A%E8%A1%A8%E6%A0%BC" aria-hidden="true"><span class="icon icon-link"></span></a>固定表格</h1><p>后台管理系统,多多少少会有列表页.</p><p>而列表页又正是由表格形成.</p><p>但是原生的表头并不能固定头部以及两侧.</p><p>一旦数据多了,查看起来就不方便了.</p><p>于是乎就出现很多固定表头/两侧的表格组件</p><h2 id="实现原理" class="heading"><a href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" aria-hidden="true"><span class="icon icon-link"></span></a>实现原理</h2><h3 id="绝对定位" class="heading"><a href="#%E7%BB%9D%E5%AF%B9%E5%AE%9A%E4%BD%8D" aria-hidden="true"><span class="icon icon-link"></span></a>绝对定位</h3><ul><li><p>实现方式</p><p>这种应该是最普遍也是最简单的方式.</p><p>就是将一个表格分成多个表格.</p><p>包括表头/左侧/右侧/表体, 共四个表格</p><p>然后通过 css 方式将表头以及两侧固定</p><p>之后通过 scroll 事件的监听,同步表头以及两侧的 scroll 值,就可以达到固定的效果</p></li><li><p>优点</p><p>实现起来简单,而且无缝滚动</p></li><li><p>缺点</p><p>表格都是使用 table-layout:fixed; 使得每个单元格宽度固定.</p><p>如果不使用 fixed 的话.则需要一个</p><colgroup><col>管理每一列的宽度.<p></p><p>这样不能达到宽度自适应的情况</p><p>滚动必须是局部滚动.而不是跟随全局.</p></colgroup></li><li><p>例子</p><p>elementUI 的表格就是这样实现的.</p><p><img src="https://zwing.site/imgur/39962386.jpg"></p><p>同一个表格的表头,表体分别复制了3次.用来形成表头和两侧的固定.</p><p>使用绝对定位固定两侧.</p><p>通过管理 scroll 的值管理表头以及两侧滚动.</p><p>这样就会导致 dom 数量的增加.</p></li></ul><h2 id="css-方法---position-sticky" class="heading"><a href="#css-%E6%96%B9%E6%B3%95---position-sticky" aria-hidden="true"><span class="icon icon-link"></span></a>css 方法 - position: sticky</h2><p>此方法原生支持固定表头.</p><p>但是目前<a href="https://caniuse.com/#feat=css-sticky">兼容性</a>不客观</p><p><img src="https://zwing.site/imgur/67634294.jpg"></p><h2 id="本文实现" class="heading"><a href="#%E6%9C%AC%E6%96%87%E5%AE%9E%E7%8E%B0" aria-hidden="true"><span class="icon icon-link"></span></a>本文实现</h2><ul><li><a href="http://zwing.site/vue-fixed-table/release/demo.html">DEMO</a>(原谅我没弄样式)</li></ul><h3 id="背景" class="heading"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true"><span class="icon icon-link"></span></a>背景</h3><p>当固定表头的需求提出来时,我也是曾经想过直接使用 elementUI 的表格.</p><p>但是发现使用 elementUI 的表格插件需要改动不少代码.而且感觉不够灵活.</p><p>于是就自己去实现</p><h3 id="第一版" class="heading"><a href="#%E7%AC%AC%E4%B8%80%E7%89%88" aria-hidden="true"><span class="icon icon-link"></span></a>第一版</h3><p>由于考虑到不想使用 fixed 布局以及组个单元格去管理宽度.</p><p>而且不想使用局部滚动</p><p>所以一开始就决定使用 监听全局滚动+transition 方式.让表格头跟随滚动走</p><p>也就是说.当表头贴近浏览器上端的时候才固定.</p><p>而不是局部滚动式的固定.</p><p>这样 thead 和 tbody 就是一体,不存在宽度不一致问题</p><h3 id="兼容性问题" class="heading"><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7%E9%97%AE%E9%A2%98" aria-hidden="true"><span class="icon icon-link"></span></a>兼容性问题</h3><p>一旦thead产生了 transform. 表格的 border-collapse 会失效.表格头的边框会消失.</p><p>为了解决这个问题.我使用阴影来替代 border.</p><p>但是在 safari 上.transform 部分不会显示出阴影..暂无解</p><p>对于 transition 问题.</p><p>在 chrome 下不存在闪烁卡顿现象, 而在 Firefox 和 safari 则存在闪烁和卡顿现象.</p><p>由于是内部系统, 使用 chrome 居多.所以 firefox 和 safari 下只做了兼容性处理.</p><h3 id="第二版" class="heading"><a href="#%E7%AC%AC%E4%BA%8C%E7%89%88" aria-hidden="true"><span class="icon icon-link"></span></a>第二版</h3><p>在第一版完成后, 基本实现了固定表格头功能. 而且在 chrome 下表现顺畅.</p><p>于是着手实现固定两侧.这里实现原理一样.所以很容易实现</p><p><img src="https://zwing.site/imgur/60520413.jpg"></p><p>这种虽然右侧是固定在浏览器右侧.</p><p>但是整体页面还是被撑开的.</p><p>那么对于表格上下的其他组件,他们依旧是被浏览器隐藏.需要横向滚动才能看到.</p><p>于是我继续开始第三版改造</p><h3 id="第三版" class="heading"><a href="#%E7%AC%AC%E4%B8%89%E7%89%88" aria-hidden="true"><span class="icon icon-link"></span></a>第三版</h3><p>这一版主要就是为了页面的其他组件不被表格的宽高影响.也就是说不管表格多高多宽.</p><p>都可以在不滚动的前提下看到.</p><p>那么就是将表格变成局部滚动了.</p><p><img src="https://zwing.site/imgur/99932867.jpg"></p><p>其实就是一个自适应的内滚动容器.</p><p>前提是页面高度宽度都是100%</p><p>也就是说要有环境让容器产生滚动</p><p>监听此容器的滚动来控制表格头和两侧的固定.</p><p>但是收到反馈说这种表格看起来很狭小.不够大气</p><p><img src="https://zwing.site/imgur/42701513.jpg"></p><p>没办法,只能继续进行思考改进</p><h3 id="思考改进" class="heading"><a href="#%E6%80%9D%E8%80%83%E6%94%B9%E8%BF%9B" aria-hidden="true"><span class="icon icon-link"></span></a>思考改进</h3><p>在开始之前我的想法是</p><p>结合第二第三版.</p><p>将垂直滚动交给页面.横向滚动自管理.</p><p>什么意思呢?</p><p>就是页面高度可以被撑开. 但是宽度不能被撑开.</p><p>也就是说全局只有 y 轴滚动.没有 x 轴滚动.</p><p>其实第三版是可以实现的.</p><p>页面只需限制宽度为100%.高度不做限制,就可以轻松的达到要求.</p><p><img src="https://zwing.site/imgur/27128653.jpg"></p><p>注意这里的高度其实没有做限制的.也就是说容器滚动条被隐藏了.</p><p>那如果要横向滚动怎么办.</p><p>很简单啊.按着 shift 再滚动就是横向滚动了.</p><p><img src="https://zwing.site/imgur/42701513.jpg"></p><p>这是不科学的.不是每个人都知道.</p><p>那样是不是可以有一条虚拟的横向滚动条, 来管理表格的横向滚动呢.</p><p>于是就有第四版</p><h3 id="第四版" class="heading"><a href="#%E7%AC%AC%E5%9B%9B%E7%89%88" aria-hidden="true"><span class="icon icon-link"></span></a>第四版</h3><p>就是就是额外添加一个虚拟滚动条的组件.</p><p>当容器底部被浏览器隐藏时候.则平移这个滚动条至屏幕底部</p><ul><li>原生滚动条被隐藏时候,显示虚拟滚动条<img src="https://zwing.site/imgur/24267221.jpg"></li><li>原生滚动条显示时候,隐藏虚拟滚动条<img src="https://zwing.site/imgur/61056576.jpg"></li></ul><p>这样, 既能使得页面不被撑开. 同时高度也不需要限定在100%.</p><p>刚好能满足需求.</p><h3 id="实现方法" class="heading"><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95" aria-hidden="true"><span class="icon icon-link"></span></a>实现方法</h3><p>实现方法其实就是使用 transform 以及监听滚动来实现固定咯.</p><p>但是在使用上,则需要有一定的规则.</p><p><img src="https://zwing.site/imgur/81508433.jpg"></p><p>也就是说</p><p>在使用的时候.要通过 slot 分别配置 head,left,right 的内容.</p><p>简单说就是把表格拆分成左/中/右</p><p>那么 thead 和 tbody 就能保持列宽度.</p><p>关键处理:</p><ul><li>通过 slot配置左/中/右以及表格头/表格体</li></ul><ul><li>hover 样式需要通过 mouseOver 和 mouseleave 去管理</li><li>通过监听表格和窗口的 resize 事件,以及使用 MutationObserver 来监听表格子节点的变化来重新获取表格宽度.(因为双侧固定需要依赖左中右的宽度)</li><li>通过监听全局滚动, 固定表格头</li><li>通过监听父容器的横向滚动, 固定两侧</li></ul><h3 id="不足之处" class="heading"><a href="#%E4%B8%8D%E8%B6%B3%E4%B9%8B%E5%A4%84" aria-hidden="true"><span class="icon icon-link"></span></a>不足之处</h3><ul><li><p>兼容性不太好, 在 chrome 表现良好(至少高版本的流畅), firefox 和 safari 则有卡顿现象,目前做法是在滚动时候,使用 opcity 将固定部分隐藏.滚动结束后显示</p></li><li><p>table 宽度变更时候. 右侧会有闪烁. 因为右侧固定算是很依赖表格宽度以及自身宽度.所以宽度变化对右侧影响很大. 暂未解决</p></li><li><p>需要有 css 支持. 让容易有一个可滚动的环境.</p></li><li><p>使用时候会把正常的 table 拆分成几部分.</p><p><img src="https://zwing.site/imgur/67633591.jpg"></p></li></ul><h3 id="aligncell-是什么-" class="heading"><a href="#aligncell-%E6%98%AF%E4%BB%80%E4%B9%88-" aria-hidden="true"><span class="icon icon-link"></span></a>AlignCell 是什么 ?</h3><p>其实就是 th 或者 td.</p><p>封装起来就是因为设计师想要达到表格每一列整体居中的前提下,左或者右对齐.</p><p>当然, 当数据量多的时候,每个单元格基本都是刚满足宽度. 直接左对齐是没问题的.</p><p>但是当数据不多.每个单元格宽度都是充足时候,这时候直接使用左对齐是不行的</p><p>那么,我也只好封装一层了. 这里就不介绍了</p><h2 id="结语" class="heading"><a href="#%E7%BB%93%E8%AF%AD" aria-hidden="true"><span class="icon icon-link"></span></a>结语</h2><p>虽然瑕疵比较多.但是开发整个组件过程,我个人是收获不少的.</p><p>由于是内部系统.也没怎么考虑兼容性.能在 chrome 顺利跑就问题不大了.</p><p>后续会继续优化</p><h2 id="放假了-过年了" class="heading"><a href="#%E6%94%BE%E5%81%87%E4%BA%86-%E8%BF%87%E5%B9%B4%E4%BA%86" aria-hidden="true"><span class="icon icon-link"></span></a>放假了, 过年了</h2><p>祝大家新年快乐 !</p></div><div class="comments"><div id="gitalk-container"></div></div></article></div></div></main><footer class="footer"><div class="center">Powered by <a target="_blank" href="https://github.com/acyortjs/acyort">AcyOrt</a> / Theme <a target="_blank" href="https://github.com/acyortjs/theme-donob">donob</a></div></footer><script src="/script/post.js"></script><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script>const gitalkConfig = JSON.parse('{"owner":"zWingz","repo":"my-blog-config","admin":["zWingz"],"clientID":"0438ed96c0cb944693a7","clientSecret":"23e7aa3152f5d03d8f20029540741d6f886c9f5b","number":11}')
  var gitalk = new Gitalk({
    ...gitalkConfig
  })
  gitalk.render('gitalk-container')</script><script defer="defer" src="/script/ribbon.js"></script></body></html>