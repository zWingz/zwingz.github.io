<!doctype html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="description" content="Just a blog."><link rel="stylesheet" href="/css/style.css"><title>使用github issues搭建博客 - zWing</title><link rel="stylesheet" href="/css/highlight.ocean.css"><link rel="stylesheet" href="/css/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"></head><body><canvas id="ribbon"></canvas><div class="main"><div class="header"><a class="logo" href="/">zWing</a><div class="menu"><a href="/archives/">Archives</a><a href="/tags/">Tags</a><a href="/about/">About</a><a href="/repo/">Repo</a></div><div class="social"><a target="_blank" href="https://github.com/zWingz/my-blog-config/issues"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path></svg></a><a target="_blank" href="/rss.xml"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.18,15.64A2.18,2.18 0 0,1 8.36,17.82C8.36,19 7.38,20 6.18,20C5,20 4,19 4,17.82A2.18,2.18 0 0,1 6.18,15.64M4,4.44A15.56,15.56 0 0,1 19.56,20H16.73A12.73,12.73 0 0,0 4,7.27V4.44M4,10.1A9.9,9.9 0 0,1 13.9,20H11.07A7.07,7.07 0 0,0 4,12.93V10.1Z"></path></svg></a></div></div><div class="content-container center"><div id="post" class="flex"><div class="toc"><div class="stay"><ul><li><a href="#%E4%BB%8B%E7%BB%8D">介绍</a></li><li><a href="#%E6%95%B4%E4%BD%93%E6%AD%A5%E9%AA%A4">整体步骤</a></li><li><a href="#%E5%85%B3%E4%BA%8E-gh-pages">关于 gh-pages</a></li><li><a href="#%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4">详细步骤</a><ul><li><a href="#%E5%88%9B%E5%BB%BArepo">创建repo</a></li><li><a href="#%E7%94%B3%E8%AF%B7%E4%B8%A4%E4%B8%AA-token">申请两个 token</a></li><li><a href="#%E5%86%99%E5%85%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">写入配置文件</a></li><li><a href="#%E9%85%8D%E7%BD%AEcircleci">配置circleci</a></li><li><a href="#%E9%85%8D%E7%BD%AEwebhook">配置webhook</a></li><li><a href="#%E5%86%99issues">写issues</a></li></ul></li><li><a href="#%E6%9C%80%E5%90%8E">最后</a></li></ul><span class="toc-icon"></span></div></div><div class="post-content"><p class="time">March 06, 2019</p><h1 class="title">使用github issues搭建博客</h1><div class="content"><p>通过<code class="language-text">issues</code>来写博客文章，并自动部署到<code class="language-text">gh-page</code>。</p><h3 id="介绍" class="heading"><a href="#%E4%BB%8B%E7%BB%8D" aria-hidden="true"><span class="icon icon-link"></span></a>介绍</h3><ul><li><a href="https://acyort.com/">acyort</a> 引擎核心，用来管理插件、工作流以及<code class="language-text">html</code>输出等。</li><li><a href="https://github.com/zWingz/acyort-donob-plugins">acyort-donob-plugins</a>：是<code class="language-text">acyort</code>的插件，用来拉取<code class="language-text">issues</code>数据并进行处理，处理完后将对应模板进行渲染。</li></ul><h3 id="整体步骤" class="heading"><a href="#%E6%95%B4%E4%BD%93%E6%AD%A5%E9%AA%A4" aria-hidden="true"><span class="icon icon-link"></span></a>整体步骤</h3><ul><li>在github新建一个 <a href="https://github.com/new">repo</a></li><li>写入配置文件</li><li>添加 <a href="https://github.com/settings/tokens/new">github token</a>, 权限为<code class="language-text">repo::public_repo</code></li><li>在 <a href="https://circleci.com">circleCi</a> 加入对应的<code class="language-text">repo</code>并创建 <a href="https://circleci.com/account/api">circleci token</a>(需要保存下来)</li><li>在<code class="language-text">circleci</code>中对应项目加入<code class="language-text">variable</code>.</li><li>在<code class="language-text">repo</code>中添加<code class="language-text">webhook</code></li><li>写<code class="language-text">issues</code></li></ul><h3 id="关于-gh-pages" class="heading"><a href="#%E5%85%B3%E4%BA%8E-gh-pages" aria-hidden="true"><span class="icon icon-link"></span></a>关于 gh-pages</h3><p><code class="language-text">gh-pages</code>有两种形式, 具体请看<a href="https://help.github.com/en/articles/user-organization-and-project-pages">官方说明</a>:</p><ul><li><p>以<code class="language-text">username.github.io</code>命名的项目，是分配给每个用户的<code class="language-text">user page</code>。</p></li><li><p>另一种是<code class="language-text">prject page</code>, 各项目中通过<code class="language-text">gh-pages</code>分支或者通过<code class="language-text">docs</code>文件夹所生成的<code class="language-text">gh-pages</code>。</p></li></ul><p>无论、以何种方式来建立起<code class="language-text">gh-pages</code>都可以。</p><p>但是如果以<code class="language-text">username.github.io</code>来创建的话，内容只能放在<code class="language-text">master</code>分支，并不能像其他<code class="language-text">repo</code>一样通过<code class="language-text">gh-pages</code>或者<code class="language-text">docs</code>文件夹生成。</p><p>下面统一用<code class="language-text">username.github.io</code> 来创建<code class="language-text">gh-pages</code></p><h3 id="详细步骤" class="heading"><a href="#%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4" aria-hidden="true"><span class="icon icon-link"></span></a>详细步骤</h3><h4 id="创建repo" class="heading"><a href="#%E5%88%9B%E5%BB%BArepo" aria-hidden="true"><span class="icon icon-link"></span></a>创建repo</h4><ul><li>创建一个<code class="language-text">username.github.io</code>的<code class="language-text">repo</code>，负责接收生成后的<code class="language-text">html</code>内容, 并生成<code class="language-text">user page</code>。</li><li>创建一个<code class="language-text">blog-config</code>(名字随意)，用来管理<code class="language-text">blog</code>配置，以及<code class="language-text">issues</code>管理。</li></ul><h4 id="申请两个-token" class="heading"><a href="#%E7%94%B3%E8%AF%B7%E4%B8%A4%E4%B8%AA-token" aria-hidden="true"><span class="icon icon-link"></span></a>申请两个 token</h4><p>两个<code class="language-text">token</code>都要自行保存, 关闭就找不回来。</p><ul><li><p>github token</p><p>申请一个具有写权限的<a href="https://github.com/settings/tokens/new">github token</a>，<code class="language-text">scope</code>选择<code class="language-text">repo::public_repo</code>, 用于将生成后的文件通过<code class="language-text">api</code>直接<code class="language-text">push</code>到该项目中。</p></li><li><p>circleci token</p><p>申请一个<a href="https://circleci.com/account/api">circleci token</a>, 用来通过<code class="language-text">webhook</code>来触发<code class="language-text">circle build</code>。</p></li></ul><h4 id="写入配置文件" class="heading"><a href="#%E5%86%99%E5%85%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" aria-hidden="true"><span class="icon icon-link"></span></a>写入配置文件</h4><p>在<code class="language-text">blog-config</code>中，创建以下文件:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">|-.circleci
	|- config.yml // circleCi 的配置文件
|-config.yml // acyort 配置文件
|-package.json // 这个不用说</code></pre></div><ul><li><p>package.json</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"blog name"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"deploy"</span><span class="token operator">:</span> <span class="token string">"acyort flow"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"acyort"</span><span class="token operator">:</span> <span class="token string">"^3.1.1"</span><span class="token punctuation">,</span>
    <span class="token property">"acyort-donob-renderer"</span><span class="token operator">:</span> <span class="token string">"^1.5.0"</span><span class="token punctuation">,</span>
    <span class="token property">"acyort-plugin-fetch-issues"</span><span class="token operator">:</span> <span class="token string">"^1.3.1"</span><span class="token punctuation">,</span>
    <span class="token property">"acyort-plugin-rss"</span><span class="token operator">:</span> <span class="token string">"^1.5.0"</span><span class="token punctuation">,</span>
    <span class="token property">"acyort-templates-donob-plus"</span><span class="token operator">:</span> <span class="token string">"^1.5.1"</span><span class="token punctuation">,</span>
    <span class="token property">"gh-pages"</span><span class="token operator">:</span> <span class="token string">"^2.0.1"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>config.yml(acyort 配置文件)</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> blog name <span class="token comment"># 博客名称</span>
<span class="token key atrule">description</span><span class="token punctuation">:</span> blog desc <span class="token comment"># 博客简介</span>
<span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//username.github.io <span class="token comment"># 博客url</span>
<span class="token key atrule">template</span><span class="token punctuation">:</span> acyort<span class="token punctuation">-</span>templates<span class="token punctuation">-</span>donob<span class="token punctuation">-</span>plus
<span class="token key atrule">menu</span><span class="token punctuation">:</span>
  <span class="token key atrule">Archives</span><span class="token punctuation">:</span> /archives/
  <span class="token key atrule">Tags</span><span class="token punctuation">:</span> /tags/
<span class="token key atrule">repository</span><span class="token punctuation">:</span> username/blog<span class="token punctuation">-</span>config <span class="token comment"># 写 issues 的项目</span>
<span class="token key atrule">public</span><span class="token punctuation">:</span> public
<span class="token key atrule">timezone</span><span class="token punctuation">:</span> Asia/Shanghai
<span class="token key atrule">plugins</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> acyort<span class="token punctuation">-</span>plugin<span class="token punctuation">-</span>fetch<span class="token punctuation">-</span>issues
  <span class="token punctuation">-</span> acyort<span class="token punctuation">-</span>donob<span class="token punctuation">-</span>renderer
</code></pre></div></li><li><p>.circleci/config.yml</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># 注意这个文件名为 config.yml，在 .circleci 目录下</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>latest
    <span class="token key atrule">working_directory</span><span class="token punctuation">:</span> ~/acyort
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token key atrule">only</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> master
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> checkout
      <span class="token punctuation">-</span> <span class="token key atrule">restore_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">keys</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> yarn<span class="token punctuation">-</span>packages<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum "yarn.lock" <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> yarn install
      <span class="token punctuation">-</span> <span class="token key atrule">save_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Save Yarn Package Cache
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span>packages<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum "yarn.lock" <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">paths</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ~/.cache/yarn
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> yarn deploy
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> git config user.name "" <span class="token comment"># 你的 github username</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> git config user.email "" <span class="token comment"># 你的 github email</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npx gh<span class="token punctuation">-</span>pages <span class="token punctuation">-</span>d public <span class="token punctuation">-</span>r https<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>gh_token<span class="token punctuation">}</span>@github.com/username/username.github.io.git <span class="token punctuation">-</span>b master <span class="token punctuation">-</span>m "Updated by circleci <span class="token punctuation">-</span> `date`" <span class="token comment"># ${gh_token}, 这个token就是具有写权限的github token, 会在 circleci 配置。</span>
</code></pre></div></li></ul><h4 id="配置circleci" class="heading"><a href="#%E9%85%8D%E7%BD%AEcircleci" aria-hidden="true"><span class="icon icon-link"></span></a>配置circleci</h4><ul><li>将<code class="language-text">blog-config</code>项目加入到<code class="language-text">circleci</code>中。</li><li>选择<code class="language-text">linux</code>和<code class="language-text">node</code>环境。</li><li>点<code class="language-text">start build</code>, 此时应该是<code class="language-text">fail</code>的, 因为<code class="language-text">gh_token</code>还未加入到环境变量中。</li><li>点左侧栏的<code class="language-text">Job</code>, 找到<code class="language-text">blog-config</code>项目, 点击设置</li><li>在<code class="language-text">BUILD SETTINGS</code>中找到<code class="language-text">Environment Variables</code></li><li>点击<code class="language-text">Add variable</code></li><li><code class="language-text">name</code>为<code class="language-text">gh_token</code>(这里名字要跟<code class="language-text">config.yml</code>中<code class="language-text">${gh_token}</code>一样), <code class="language-text">value</code>填入刚刚申请到的<code class="language-text">gh-token</code>。</li><li>回到<code class="language-text">circleci</code>项目中, 点击上一次的<code class="language-text">build fail</code>条目, 右上角有<code class="language-text">rebuild</code></li><li>此时如无意外, 应该能成功<code class="language-text">build</code>, 并且<code class="language-text">username.github.io</code>这个仓库也有对应文件。</li></ul><h4 id="配置webhook" class="heading"><a href="#%E9%85%8D%E7%BD%AEwebhook" aria-hidden="true"><span class="icon icon-link"></span></a>配置webhook</h4><p>回到<code class="language-text">blog-config</code>项目中配置</p><ul><li>点<code class="language-text">settings</code></li><li>点<code class="language-text">webhook</code></li><li>点<code class="language-text">Add webhook</code></li><li><code class="language-text">Payload URL</code>填入'<a href="https://circleci.com/api/v1.1/project/github/:username/:project/tree/:branch?circle-token=:token">https://circleci.com/api/v1.1/project/github/:username/:project/tree/:branch?circle-token=:token</a>' (自行替换相应字段), 其中<code class="language-text">:token</code>是从<code class="language-text">circleci</code>中申请的<code class="language-text">token</code>)</li><li><code class="language-text">Content-Type</code>选择<code class="language-text">application/json</code></li><li>下面选择<code class="language-text">let me select xxx</code>, 并勾选<code class="language-text">issues</code>选项</li><li>最下面点击<code class="language-text">save</code></li><li>完成</li></ul><h4 id="写issues" class="heading"><a href="#%E5%86%99issues" aria-hidden="true"><span class="icon icon-link"></span></a>写issues</h4><p>至此博客已经算搭建完成，只需要在<code class="language-text">blog-config</code>写<code class="language-text">issues</code>, 就会同步部署到<code class="language-text">gh-pages</code>。</p><h3 id="最后" class="heading"><a href="#%E6%9C%80%E5%90%8E" aria-hidden="true"><span class="icon icon-link"></span></a>最后</h3><p>更多配置请参考</p><ul><li><a href="https://acyort.com/">acyort</a></li><li><a href="https://github.com/zWingz/acyort-donob-plugins">acyort-donob-plugins</a></li><li><a href="https://github.com/zWingz/my-blog-config">blog-config</a></li></ul></div><div class="comments"><div id="gitalk-container"></div></div></div></div></div></div><div class="footer"><div class="center">zWing / Powered by <a target="_blank" href="https://github.com/acyortjs/acyort">AcyOrt</a> / Theme <a target="_blank" href="https://github.com/acyortjs/theme-donob">donob</a></div></div><script src="/script/post.js"></script><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script>const gitalkConfig = JSON.parse('{"owner":"zWingz","repo":"my-blog-config","admin":["zWingz"],"clientID":"0438ed96c0cb944693a7","clientSecret":"23e7aa3152f5d03d8f20029540741d6f886c9f5b","number":29}')
  var gitalk = new Gitalk({
    ...gitalkConfig
  })
  gitalk.render('gitalk-container')</script><script defer="defer" src="/script/ribbon.js"></script></body></html>