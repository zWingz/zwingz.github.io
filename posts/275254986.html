<!doctype html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="description" content="Just a blog."><link rel="stylesheet" href="/css/style.css"><title>vue后台系统开发实践 - zWing</title><link rel="stylesheet" href="/css/highlight.ocean.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"></head><body><canvas id="ribbon"></canvas><div class="main"><div class="header"><a class="logo" href="/">zWing</a><div class="menu"><a href="/archives/">Archives</a><a href="/about/">About</a></div><div class="social"><a target="_blank" href="https://github.com/zWingz/my-blog-config/issues"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path></svg></a><a target="_blank" href="/rss.xml"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.18,15.64A2.18,2.18 0 0,1 8.36,17.82C8.36,19 7.38,20 6.18,20C5,20 4,19 4,17.82A2.18,2.18 0 0,1 6.18,15.64M4,4.44A15.56,15.56 0 0,1 19.56,20H16.73A12.73,12.73 0 0,0 4,7.27V4.44M4,10.1A9.9,9.9 0 0,1 13.9,20H11.07A7.07,7.07 0 0,0 4,12.93V10.1Z"></path></svg></a></div></div><div id="post" class="center"><div class="toc"><div class="stay"><ul><li><a href="#vue%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5">Vue后台系统开发实践</a><ul><li><a href="#%E4%BE%9D%E8%B5%96%E5%BA%93">依赖库</a></li><li><a href="#%E6%90%AD%E5%BB%BA%E6%B5%81%E7%A8%8B">搭建流程</a></li><li><a href="#%E5%90%8E%E5%8F%B0%E5%A4%A7%E8%87%B4%E5%86%85%E5%AE%B9">后台大致内容</a></li><li><a href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90">问题分析</a></li><li><a href="#%E7%BB%84%E4%BB%B6">组件</a><ul><li><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F">实现方式</a></li></ul></li><li><a href="#%E5%BB%BA%E8%AE%AE">建议</a></li><li><a href="#%E5%AE%89%E5%88%A9">安利</a></li></ul></li></ul><span class="toc-icon"></span></div></div><div class="post-content"><p class="time">November 20, 2017</p><h1 class="title">vue后台系统开发实践</h1><div class="content"><h1 id="vue%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5" class="heading"><a href="#vue%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5" class="heading-anchor"></a>Vue后台系统开发实践</h1><h2 id="%E4%BE%9D%E8%B5%96%E5%BA%93" class="heading"><a href="#%E4%BE%9D%E8%B5%96%E5%BA%93" class="heading-anchor"></a>依赖库</h2><ul><li><a href="mailto:vue@2.4.4">vue@2.4.4</a></li><li><a href="mailto:vue-router@3.0.0">vue-router@3.0.0</a></li><li><a href="mailto:vuex@3.0.0">vuex@3.0.0</a></li><li>axios</li><li>element-ui</li></ul><h2 id="%E6%90%AD%E5%BB%BA%E6%B5%81%E7%A8%8B" class="heading"><a href="#%E6%90%AD%E5%BB%BA%E6%B5%81%E7%A8%8B" class="heading-anchor"></a>搭建流程</h2><ol><li><p><a href="https://github.com/zWingz/vue-webpack-template">webpack-template</a></p></li><li><p>createApp.js, createRouter.js, store.js, http.js</p><ul><li>createaApp.js 多页时候用来配置各个页面相同的vue选项,比如配置api,mixin等等</li><li>createRouter.js 多页时候用到配置各个页面相同的路由选项,比如配置路由模式,路由钩子等等</li><li>store.js 配置全局状态管理.state,action,mutation,getter</li><li>http.js 配置异步请求, 例如: baseRoot, 请求钩子interceptors</li></ul></li><li><p>utils.js, ConstValue.js, mixin.js, registerComponent.js</p><ul><li>utils.js 工具类函数</li><li>ConstValue.js 常量,例如: isProduction, httpRoot(后端地址)</li><li>mixin.js 混合</li><li>registerComponent.js 将经常用到的组件在这里引入并注册为全局组件</li></ul></li><li><p>route.js, app.js</p><ul><li>route/.js 具体的路由</li><li>app.js 每个页面的app启动页</li></ul></li><li><p>page-view&amp;components</p><ul><li>页面级内容</li></ul></li></ol><h2 id="%E5%90%8E%E5%8F%B0%E5%A4%A7%E8%87%B4%E5%86%85%E5%AE%B9" class="heading"><a href="#%E5%90%8E%E5%8F%B0%E5%A4%A7%E8%87%B4%E5%86%85%E5%AE%B9" class="heading-anchor"></a>后台大致内容</h2><ul><li>登录/权限</li><li>列表页</li><li>详情/审核页</li><li>创建/修改页</li></ul><h2 id="%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90" class="heading"><a href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90" class="heading-anchor"></a>问题分析</h2><ul><li><p>登录/权限</p><ul><li>登录态的保存.以及用户权限的判断<ol><li>后端设置sessionid, 前端只需要在axios配置withCredentials=true.(此方法在Safari行不通,safari默认选项(仅)允许来自我访问的网站, 由于后端地址不是直接访问.所以safari不会带上cookie去请求.部署的时候将前后端都部署到同一个nginx就可以解决)</li><li>json web token(jwt)</li><li>后端生成token,并由保存在http header.</li><li>权限判断一种是导航显示控制,一种是直接通过url进去后的判断</li></ol></li></ul></li><li><p>列表页</p><ul><li><p>内容过多.会引起页面滚动.表头以及两侧需固定</p><ol><li>全局滚动.(表格过大.页面整体会被撑开)</li><li>容器内滚动.(表格显得很狭窄)</li><li>垂直方向全局滚动, 水平方向是局部滚动. (页面宽度不被撑开, 加虚拟滚动条辅助时候水平滚动不需要拉到最后)</li><li><a href="https://zwingz.github.io/vue-fixed-table/release/demo.html">Demo</a></li></ol></li><li><p>有很多的查询条件</p><ul><li>查询需要被保留,同时url需要被查询条件修改(<code>$router.replace</code>)</li></ul></li><li><p>每一个列表页类似.但又有不同,主要差异在于查询条件以及表格内容</p><ul><li>使用mixin</li><li>设置查询query</li><li>根据query以及url获取数据</li><li>对数据进行处理,比如: loading态设为false, 初始化多选等. 看具体</li></ul></li><li><p>列表页/详情页切换后列表数据的保存(保留列表页状态)</p><ul><li>vuex(全局状态管理, 写起来会很多,一个页面一个state,action,mutation,getters)</li><li>keepAlive(active/mounted获取数据, active会导致数据次数过多, mounted会导致数据不同步. 此时可以使用trigger,主动触发列表页拉取数据)</li></ul></li></ul></li><li><p>详情页/审核页</p><ul><li><p>数据展示形式类似. 形如: label: content;</p><ul><li>声明式会导致页面重复内容过多</li><li>封装Field组件,通过js去配置数据展示</li></ul></li><li><p>布局类似</p><ul><li>这是无解的,除非真的很像很像.就可以用mixin解决</li></ul></li></ul></li><li><p>创建/修改页</p><ul><li><p>数据形式类似. 形如: label: form</p><ul><li>声明式同样导致重复内容过多</li><li>依然使用封装的Field组件,通过js去配置form.</li></ul></li><li><p>数据验证. 简单点就是能否提交</p><ul><li>要么逐个验证</li><li>要么简单粗暴添加一个canSave的computed.保证数据不为空</li></ul></li></ul></li></ul><h2 id="%E7%BB%84%E4%BB%B6" class="heading"><a href="#%E7%BB%84%E4%BB%B6" class="heading-anchor"></a>组件</h2><ul><li><p>Table(如上所说) <a href="https://zwingz.github.io/vue-fixed-table/release/demo.html">Demo</a></p></li><li><p>LoadingBar(顶部的进度条,主要是切换路由时候出现,挂在beforeEach和afterEach中调用, 有异步路由时候建议使用)</p></li><li><p>Message(消息提示)</p><h4 id="%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F" class="heading"><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F" class="heading-anchor"></a>实现方式</h4><div class="hljs"><table><tbody><tr><td class="line"><pre><span>1</span>
<span>2</span>
</pre></td><td class="code"><pre>  1. 使用createElement创建dom元素,并且把message组件挂载上去即可,不过需要使用到vue完整版
  2. 将组件挂在到App.vue中,并使用vuex管理其状态. 可以在初次调用message时候才注册store</pre></td></tr></tbody></table></div></li><li><p>Modal 没什么好说.哪里用到就声明一个Modal.</p></li><li><p>Confirm(确认式提升,与message一样的实现方式)</p></li><li><p>AsyncButton(会触发异步操作的按钮,监听异步请求的路由,当请求未结束时button处于loading态.)</p></li><li><p>AutoCompleteInput(带搜索建议的Input. 可以封装多装搜索框)</p></li><li><p>Panel (可收缩面包.很简单)</p></li><li><p>Field (label: content\form; 类型展示组件)</p></li><li><p>Pagination (分页,很简单)</p></li><li><p>Tree (树, 使用递归组件即可, 如果要做节点多选, 管理选择状态会比较麻烦.)</p></li><li><p>Select, Checkbox, Radio, Switch (自定义组件v-model即可,简单)</p></li><li><p>Spin (请求时间很长的时候, 可以弹出model,并构建一个假的进度条. 上传文件的时候也能用到,当然这时候的进度是真实的.通过onprogress获取)</p></li><li><p>BackToTop (回到顶部, 加个贝塞尔动画就好了)</p></li><li><p>Scroller (自定义非原生滚动条, 建议直接用css来设置原生scroll样式.目前应该firefox不支持设置原生滚动条样式)</p></li><li><p>Img (hover时候出现蒙层.点击时候出现查看器)</p></li></ul><h2 id="%E5%BB%BA%E8%AE%AE" class="heading"><a href="#%E5%BB%BA%E8%AE%AE" class="heading-anchor"></a>建议</h2><ol><li><p>如果对组件进行for命令,必须加上:key,这是官方指定. 但对于原生dom进行for循环时候.其实可以不加:key,或者使用index作为key. 一旦设置了key,只有key得值不一样,会直接销毁重建dom. 那么用index作为key的话,则只会更新dom而不会销毁重建</p></li><li><p>任何通过addEventListeners添加的监听事件,销毁时最好使用removeEventListeners给去掉</p></li><li><p>如果不需要运行时构建,可以在webpack中指定使用vue.runtime.js, 会剩了几十k体积</p></li><li><p>sass-loader前再加一层sass-resources-loader可以将一些变量或者方法全局引入,那就不用到处import了.</p></li></ol><div class="hljs"><table><tbody><tr><td class="line"><pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
<span>6</span>
</pre></td><td class="code"><pre>    {
        loader: &#39;sass-resources-loader&#39;,
        options: {
            resources: [path.resolve(__dirname, &#39;..&#x2F;src&#x2F;sass&#x2F;variable.scss&#39;)]
        }
    }</pre></td></tr></tbody></table></div><h2 id="%E5%AE%89%E5%88%A9" class="heading"><a href="#%E5%AE%89%E5%88%A9" class="heading-anchor"></a>安利</h2><p><a href="https://fundebug.com/">Fundebug</a></p><p><a href="https://www.easy-mock.com/">EasyMock</a></p><p><a href="http://apizza.cc/account">Apizza</a></p></div><div class="comments"><div id="gitalk-container"></div></div></div></div></div><div class="footer"><div class="center">zWing / Powered by <a target="_blank" href="https://github.com/acyortjs/acyort">AcyOrt</a> / Theme <a target="_blank" href="https://github.com/acyortjs/theme-donob">donob</a></div></div><script src="/script/post.js"></script><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script>const gitalkConfig = JSON.parse('{"owner":"zWingz","repo":"my-blog-config","admin":["zWingz"],"clientID":"0438ed96c0cb944693a7","clientSecret":"23e7aa3152f5d03d8f20029540741d6f886c9f5b","number":2}')
  var gitalk = new Gitalk({
    ...gitalkConfig
  })
  gitalk.render('gitalk-container')</script><script defer="defer" src="/script/ribbon.js"></script></body></html>