<!doctype html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="description" content="Just a blog."><link rel="stylesheet" href="/css/style.css"><title>多package下babel编译问题 - zWing</title><link rel="stylesheet" href="/css/highlight.ocean.css"><link rel="stylesheet" href="/css/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"></head><body><canvas id="ribbon"></canvas><div class="main"><div class="header"><a class="logo" href="/">zWing</a><div class="menu"><a href="/archives/">Archives</a><a href="/tags/">Tags</a><a href="/about/">About</a><a href="/repo/">Repo</a></div><div class="social"><a target="_blank" href="https://github.com/zWingz/my-blog-config/issues"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path></svg></a><a target="_blank" href="/rss.xml"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.18,15.64A2.18,2.18 0 0,1 8.36,17.82C8.36,19 7.38,20 6.18,20C5,20 4,19 4,17.82A2.18,2.18 0 0,1 6.18,15.64M4,4.44A15.56,15.56 0 0,1 19.56,20H16.73A12.73,12.73 0 0,0 4,7.27V4.44M4,10.1A9.9,9.9 0 0,1 13.9,20H11.07A7.07,7.07 0 0,0 4,12.93V10.1Z"></path></svg></a></div></div><div class="content-container center"><div id="post" class="flex"><div class="toc"><div class="stay"><ul><li><a href="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF">项目背景</a></li><li><a href="#%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A0">问题原因</a></li><li><a href="#%E4%B8%8A%E8%BF%B0%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95">上述问题解决办法</a></li></ul><span class="toc-icon"></span></div></div><div class="post-content"><p class="time">November 14, 2018</p><h1 class="title">多package下babel编译问题</h1><div><a href="/tags/1127343300" class="tags-item" style="background: #866bef;">Babel </a><a href="/tags/819211154" class="tags-item" style="background: #92efc8;">Front End</a></div><div class="content"><h2 id="项目背景" class="heading"><a href="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF" aria-hidden="true"><span class="icon icon-link"></span></a>项目背景</h2><p>之前一直使用<code class="language-text">typescript</code> + <code class="language-text">babel</code> 编译项目</p><p><code class="language-text">typescript</code>作用只是单纯用来做强类型检查, <code class="language-text">babel</code>则真正用来编译代码.</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"exnext"</span>
<span class="token punctuation">}</span>
</code></pre></div><p>偶然一次机会, 发现编译后的部分代码并没有编译<code class="language-text">object-rest-spread</code> 而这部分代码全都在一个子目录下</p><p>由于我的项目使用了<code class="language-text">git-submodules</code>来管理组件, 所以该组件目录下带有<code class="language-text">package.json</code>文件</p><p>恰好这部分文件只经过了<code class="language-text">typescript</code>的编译, 而没有经过<code class="language-text">babel</code></p><p>其他<code class="language-text">Page</code>都正确的被<code class="language-text">babel</code>编译, 不存在问题.</p><p>于是想起是否子目录下的文件不被<code class="language-text">babel</code>编译, 看了下官方文档, 的确有相关的描述.</p><h2 id="问题原因" class="heading"><a href="#%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A0" aria-hidden="true"><span class="icon icon-link"></span></a>问题原因</h2><p>当项目目录中含有多个<code class="language-text">package.json</code>时候, 原有的<code class="language-text">.babelrc</code>已经不再适用</p><p><img src="https://user-images.githubusercontent.com/13031838/48480504-a09f9300-e845-11e8-9edc-3f42bb145c2f.png" alt="image">.</p><p>这时候经过<code class="language-text">webpack</code>编译 只有<code class="language-text">src</code>下的文件会被正确编译, <code class="language-text">sub</code>下的文件不会被<code class="language-text">babel</code>编译</p><p>此时<code class="language-text">webpack</code>会报错</p><p><img src="https://user-images.githubusercontent.com/13031838/48480915-d4c78380-e846-11e8-80e5-b4bc1c518474.png" alt="image"></p><p>原因就是这部分文件没有被<code class="language-text">babel</code>正确编译</p><h2 id="上述问题解决办法" class="heading"><a href="#%E4%B8%8A%E8%BF%B0%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95" aria-hidden="true"><span class="icon icon-link"></span></a>上述问题解决办法</h2><p>官方有<a href="https://babeljs.io/docs/en/config-files#project-wide-configuration">详细说明</a></p><p>将<code class="language-text">.babelrc</code>改成<code class="language-text">babel.config.js</code>, 此时<code class="language-text">sub</code>下的文件可以被正确编译</p><p><img src="https://user-images.githubusercontent.com/13031838/48481024-15270180-e847-11e8-909b-3af7c5a7b209.png" alt="image"></p><p>当然, 使用<code class="language-text">babel.config.js</code>还可以灵活的配置各个<code class="language-text">package</code>中<code class="language-text">babel</code>编译规则. 具体的还是请看官方文档</p></div><div class="comments"><div id="gitalk-container"></div></div></div></div></div></div><div class="footer"><div class="center">zWing / Powered by <a target="_blank" href="https://github.com/acyortjs/acyort">AcyOrt</a> / Theme <a target="_blank" href="https://github.com/acyortjs/theme-donob">donob</a></div></div><script src="/script/post.js"></script><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script>const gitalkConfig = JSON.parse('{"owner":"zWingz","repo":"my-blog-config","admin":["zWingz"],"clientID":"0438ed96c0cb944693a7","clientSecret":"23e7aa3152f5d03d8f20029540741d6f886c9f5b","number":19}')
  var gitalk = new Gitalk({
    ...gitalkConfig
  })
  gitalk.render('gitalk-container')</script><script defer="defer" src="/script/ribbon.js"></script></body></html>