<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="description" content="electron+react开发实践"><meta name="keywords" content=""><link rel="stylesheet" href="/css/prism.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><title>electron+react开发实践 - zWing</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6650629ba7ddbfe98e2f63700c2e6923";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body><div class="indicator"></div><canvas id="ribbon"></canvas><main class="main"><header class="header"><a class="logo" href="/">zWing</a><nav class="menu"><a href="/archives/">Archives</a><a href="/tags/">Tags</a><a href="/about/">About</a><a href="/repo/">Repo</a></nav><div class="social"><a target="_blank" href="/rss.xml"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.18,15.64A2.18,2.18 0 0,1 8.36,17.82C8.36,19 7.38,20 6.18,20C5,20 4,19 4,17.82A2.18,2.18 0 0,1 6.18,15.64M4,4.44A15.56,15.56 0 0,1 19.56,20H16.73A12.73,12.73 0 0,0 4,7.27V4.44M4,10.1A9.9,9.9 0 0,1 13.9,20H11.07A7.07,7.07 0 0,0 4,12.93V10.1Z"></path></svg> </a><a target="_blank" href="https://github.com/zWingz/my-blog-config/issues"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path></svg></a></div></header><div class="content-container center"><div id="post" class="flex"><aside class="toc"><div class="stay"><ul><li><a href="#%E8%83%8C%E6%99%AF">背景</a></li><li><a href="#%E6%8A%80%E6%9C%AF%E6%A0%88%E4%BB%A5%E5%8F%8A%E4%B8%BB%E8%A6%81%E4%BE%9D%E8%B5%96">技术栈以及主要依赖</a></li><li><a href="#electron%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8Cweb">electron如何运行web</a></li><li><a href="#%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8">项目启动</a></li><li><a href="#%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91">项目开发</a><ul><li><a href="#github-oauth">github oauth</a></li><li><a href="#github-api%E5%BC%80%E5%8F%91">github api开发</a></li><li><a href="#github-%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E5%A6%82%E4%BD%95%E5%8A%A0%E8%BD%BD%E5%9B%BE%E7%89%87">github 私有仓库如何加载图片</a></li><li><a href="#cache%E7%BC%93%E5%AD%98">cache缓存</a></li><li><a href="#%E5%BC%82%E6%AD%A5%E9%98%9F%E5%88%97">异步队列</a></li><li><a href="#monaco%E7%BC%96%E8%BE%91%E5%99%A8%E5%8A%A0%E8%BD%BD">monaco编辑器加载</a></li><li><a href="#markdown%E9%A2%84%E8%A7%88%E4%BB%A5%E5%8F%8A%E6%BB%9A%E5%8A%A8%E5%90%8C%E6%AD%A5">markdown预览以及滚动同步</a></li></ul></li></ul><span class="toc-icon"></span></div></aside><article class="post-content"><time class="time">September 05, 2019</time><h1 class="title">electron+react开发实践</h1><div class="content"><h2 id="背景" class="heading"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true"><span class="icon icon-link"></span></a>背景</h2><p><a href="https://github.com/zWingz/Hyrule">Hyrule</a></p><p>本文也是在Hyrule下完成</p><h2 id="技术栈以及主要依赖" class="heading"><a href="#%E6%8A%80%E6%9C%AF%E6%A0%88%E4%BB%A5%E5%8F%8A%E4%B8%BB%E8%A6%81%E4%BE%9D%E8%B5%96" aria-hidden="true"><span class="icon icon-link"></span></a>技术栈以及主要依赖</h2><ul><li><a href="https://github.com/facebook/react">react</a></li><li><a href="https://github.com/ant-design/ant-design">antd</a></li><li><a href="https://github.com/electron/electron">electron</a></li><li><a href="https://github.com/microsoft/TypeScript">typescript</a></li><li><a href="https://github.com/microsoft/monaco-editor">monaco-editor</a></li><li><a href="https://github.com/remarkjs/remark">remark</a></li></ul><p>electron提供跨平台PC端运行环境，使用react+antd构建UI界面</p><p>monaco-editor提供编辑器功能，使用remark转换markdown</p><h2 id="electron如何运行web" class="heading"><a href="#electron%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8Cweb" aria-hidden="true"><span class="icon icon-link"></span></a>electron如何运行web</h2><p>electron作用就是提供多端运行环境，实际开发体验跟一般Web开发无二</p><p>万事开头难，初次接触的确不知道如何入手，github上也有相应的模板</p><ul><li><a href="https://github.com/SimulatedGREG/electron-vue">electron-vue</a></li><li><a href="https://github.com/electron-react-boilerplate/electron-react-boilerplate">electron-react-boilerplate</a></li></ul><p>不管模板如何，核心还是如何在electron中加载html</p><p>electron分为主进程(main)和渲染进程(renderer)，主进程可以跟操作系统打交道，渲染进程可以说跟页面打交道(webapp)，因此只需要在主进程创建一个<code class="language-text">window</code>来跑页面即可。</p><p>如果只是开发普通页面，那只要加载html即可，如果使用webpack开发，则开发时候需要在electron中访问dev-server提供的页面</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 创建一个window, 用于加载html</span>
  title<span class="token punctuation">:</span> app<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  minHeight<span class="token punctuation">:</span> <span class="token number">750</span><span class="token punctuation">,</span>
  minWidth<span class="token punctuation">:</span> <span class="token number">1090</span><span class="token punctuation">,</span>
  webPreferences<span class="token punctuation">,</span>
  show<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 避免app启动时候显示出白屏</span>
  backgroundColor<span class="token punctuation">:</span> <span class="token string">'#2e2c29'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isDev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  win<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8989/'</span><span class="token punctuation">)</span> <span class="token comment">// 开发环境访问dev-server提供的页面</span>
  <span class="token comment">// 配置react-dev-tool</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span> installExtension<span class="token punctuation">,</span>
    <span class="token constant">REACT_DEVELOPER_TOOLS</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'electron-devtools-installer'</span><span class="token punctuation">)</span>
  <span class="token function">installExtension</span><span class="token punctuation">(</span><span class="token constant">REACT_DEVELOPER_TOOLS</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Added Extension:  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'An error occurred: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// win.webContents.openDevTools()</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 生产环境直接加载index.html</span>
  win<span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/../../../renderer/index.html`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>至此, 就可以在electron中运行开发的webapp, 剩下的工作便跟日常开发一样</p><h2 id="项目启动" class="heading"><a href="#%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8" aria-hidden="true"><span class="icon icon-link"></span></a>项目启动</h2><p>如上面所说, 在启动开发环境时候, 需要两个进程</p><ul><li>devServer: 使用webpack来启动webapp开发环境</li><li>electron: 直接使用node来执行main.js, 启动electron</li></ul><p>但由于使用typescript来开发, 在web端可以由webpack来完成, 那么在electron中, 则多了一步来编译</p><p>因此整个开发环境启动有三步</p><ul><li>dev:web 启动dev-server</li><li>dev:main 编译main.ts到./dist/main.js</li><li>dev:electron 执行main.js, 启动electron(借助nodemon来自动重启)</li></ul><p>目前还未特意去寻找一键启动方法, 因此启动步骤稍微多</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"dev:web"</span><span class="token operator">:</span> <span class="token string">"node ./build/devServer.js"</span><span class="token punctuation">,</span>
    <span class="token property">"build:web"</span><span class="token operator">:</span> <span class="token string">"webpack --progress --hide-modules --colors --config=build/prod.conf.js"</span><span class="token punctuation">,</span>
    <span class="token property">"dev:main"</span><span class="token operator">:</span> <span class="token string">"yarn build:main --watch"</span><span class="token punctuation">,</span>
    <span class="token property">"build:main"</span><span class="token operator">:</span> <span class="token string">"tsc -p tsconfig.electron.json"</span><span class="token punctuation">,</span>
    <span class="token property">"dev:electron"</span><span class="token operator">:</span> <span class="token string">"nodemon --watch ./dist/main --exec electron ./dist/electron/src/main/main.js"</span><span class="token punctuation">,</span>
    <span class="token property">"build:package"</span><span class="token operator">:</span> <span class="token string">"electron-builder --config ./electronrc.js -mwl"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"yarn build:web &amp;&amp; yarn build:main &amp;&amp; yarn build:package"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="项目开发" class="heading"><a href="#%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91" aria-hidden="true"><span class="icon icon-link"></span></a>项目开发</h2><p>接下来, 只需要重点开发webapp即可, electron端可以作为辅助, 提供一些系统级别调用功能</p><p>下面讲讲开发过程中遇到的问题以及解决方法</p><h3 id="github-oauth" class="heading"><a href="#github-oauth" aria-hidden="true"><span class="icon icon-link"></span></a>github oauth</h3><h3 id="github-api开发" class="heading"><a href="#github-api%E5%BC%80%E5%8F%91" aria-hidden="true"><span class="icon icon-link"></span></a>github api开发</h3><h3 id="github-私有仓库如何加载图片" class="heading"><a href="#github-%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E5%A6%82%E4%BD%95%E5%8A%A0%E8%BD%BD%E5%9B%BE%E7%89%87" aria-hidden="true"><span class="icon icon-link"></span></a>github 私有仓库如何加载图片</h3><h3 id="cache缓存" class="heading"><a href="#cache%E7%BC%93%E5%AD%98" aria-hidden="true"><span class="icon icon-link"></span></a>cache缓存</h3><h3 id="异步队列" class="heading"><a href="#%E5%BC%82%E6%AD%A5%E9%98%9F%E5%88%97" aria-hidden="true"><span class="icon icon-link"></span></a>异步队列</h3><h3 id="monaco编辑器加载" class="heading"><a href="#monaco%E7%BC%96%E8%BE%91%E5%99%A8%E5%8A%A0%E8%BD%BD" aria-hidden="true"><span class="icon icon-link"></span></a>monaco编辑器加载</h3><h3 id="markdown预览以及滚动同步" class="heading"><a href="#markdown%E9%A2%84%E8%A7%88%E4%BB%A5%E5%8F%8A%E6%BB%9A%E5%8A%A8%E5%90%8C%E6%AD%A5" aria-hidden="true"><span class="icon icon-link"></span></a>markdown预览以及滚动同步</h3></div><div class="comments"><div id="gitalk-container"></div></div></article></div></div></main><footer class="footer"><div class="center">Powered by <a target="_blank" href="https://github.com/acyortjs/acyort">AcyOrt</a> / Theme <a target="_blank" href="https://github.com/acyortjs/theme-donob">donob</a></div></footer><script src="/script/post.js"></script><script defer="defer" src="/script/ribbon.js"></script></body></html>