<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="description" content="介绍三个React组件"><meta name="keywords" content="react component,form wrapper,image,table,component"><link rel="stylesheet" href="/css/prism.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><title>介绍三个React组件 - zWing</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6650629ba7ddbfe98e2f63700c2e6923";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body><div class="indicator"></div><canvas id="ribbon"></canvas><main class="main"><header class="header"><a class="logo" href="/">zWing</a><nav class="menu"><a href="/archives/">Archives</a><a href="/tags/">Tags</a><a href="/about/">About</a><a href="/repo/">Repo</a></nav><div class="social"><a target="_blank" href="/rss.xml"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.18,15.64A2.18,2.18 0 0,1 8.36,17.82C8.36,19 7.38,20 6.18,20C5,20 4,19 4,17.82A2.18,2.18 0 0,1 6.18,15.64M4,4.44A15.56,15.56 0 0,1 19.56,20H16.73A12.73,12.73 0 0,0 4,7.27V4.44M4,10.1A9.9,9.9 0 0,1 13.9,20H11.07A7.07,7.07 0 0,0 4,12.93V10.1Z"></path></svg> </a><a target="_blank" href="https://github.com/zWingz/my-blog-config/issues"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path></svg></a></div></header><div class="content-container center"><div id="post" class="flex"><aside class="toc"><div class="stay"><ul><li><a href="#react-image">React-Image</a><ul><li><a href="#image">Image</a></li><li><a href="#preview">Preview</a></li></ul></li><li><a href="#react-table">React-Table</a><ul><li><a href="#antd%E7%9A%84%E8%A1%A8%E6%A0%BC">antd的表格</a></li><li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95">解决方法</a></li><li><a href="#%E4%B8%8D%E8%B6%B3%E7%82%B9">不足点</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F">使用方式</a></li></ul></li><li><a href="#react-form-wrapper">React-Form-Wrapper</a><ul><li><a href="#%E9%93%BE%E5%BC%8Fkey%E7%9A%84%E8%AF%BB%E5%86%99%E5%AE%9E%E7%8E%B0">链式key的读写实现</a></li></ul></li><li><a href="#%E6%9C%80%E5%90%8E">最后</a></li></ul><span class="toc-icon"></span></div></aside><article class="post-content"><time class="time">April 02, 2019</time><h1 class="title">介绍三个React组件</h1><div><a href="/tags/989715361" class="tags-item" style="background: #a6c613;">React </a><a href="/tags/1299966716" class="tags-item" style="background: #92efa1;">Component</a></div><div class="content"><p>简单介绍三个React组件吧。</p><ul><li>Image</li><li>Table</li><li>Form</li></ul><h3 id="react-image" class="heading"><a href="#react-image" aria-hidden="true"><span class="icon icon-link"></span></a>React-Image</h3><p><a href="https://github.com/zWingz/react-image">源码</a> <a href="https://zwing.site/react-image/#/">Demo</a></p><p>一个用于加载/预览图片的组件</p><h4 id="image" class="heading"><a href="#image" aria-hidden="true"><span class="icon icon-link"></span></a>Image</h4><ul><li>自动管理图片的<code class="language-text">loading</code>和<code class="language-text">error</code>状态, 并显示不同提示.</li><li>通过<code class="language-text">IntersectionObserver</code>来实现图片懒加载</li><li>默认使用<code class="language-text">Preview</code>来进行图片预览</li><li>可以通过<code class="language-text">group</code>来管理图片预览列表, 同一个<code class="language-text">group</code>的图片会出现在预览列表中</li></ul><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Image <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@zzwing/react-image'</span>

<span class="token punctuation">;</span><span class="token operator">&lt;</span>Image src<span class="token operator">=</span><span class="token string">'any.jpg'</span> width<span class="token operator">=</span><span class="token string">'200px'</span> height<span class="token operator">=</span><span class="token string">'200px'</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onClick<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
</code></pre></div><h4 id="preview" class="heading"><a href="#preview" aria-hidden="true"><span class="icon icon-link"></span></a>Preview</h4><p>图片浏览器, 可以放大/移动/切换等. 已集成到<code class="language-text">Image</code>中, 可以通过<code class="language-text">preview={false}</code>关闭预览功能. 也可以直接通过<code class="language-text">api</code>调用</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> PreviewApi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@zzwing/react-image'</span>
<span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1.jpg'</span><span class="token punctuation">,</span> <span class="token string">'2.jpg'</span><span class="token punctuation">,</span> <span class="token string">'3.jpg'</span><span class="token punctuation">]</span>
<span class="token comment">// use index</span>
PreviewApi<span class="token punctuation">.</span><span class="token function">preview</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span>
<span class="token comment">// or use src</span>
PreviewApi<span class="token punctuation">.</span><span class="token function">preview</span><span class="token punctuation">(</span><span class="token string">'2.jpg'</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span>
</code></pre></div><p> <img src="https://user-gold-cdn.xitu.io/2019/4/1/169d8317e3b43999?w=1173&#x26;h=858&#x26;f=png&#x26;s=101695"> </p><h3 id="react-table" class="heading"><a href="#react-table" aria-hidden="true"><span class="icon icon-link"></span></a>React-Table</h3><p><a href="https://github.com/zWingz/react-table">源码</a> <a href="https://zwing.site/react-table/#/">Demo</a></p><p>可固定表头及两侧的表格.</p><h4 id="antd的表格" class="heading"><a href="#antd%E7%9A%84%E8%A1%A8%E6%A0%BC" aria-hidden="true"><span class="icon icon-link"></span></a>antd的表格</h4><p><code class="language-text">antd</code>的表格也能满足该功能, 但也有几个不足点(我个人觉得)</p><ul><li>要求每一列都要写入<code class="language-text">width</code>用来固定列宽: 通过拆分<code class="language-text">thead</code>和<code class="language-text">tbody</code>来固定表头, 通过<code class="language-text">colgroup</code>来完成列宽的固定</li><li>表格高度不能自适应(有可能我使用方式不对?)</li><li>还有一点就是<code class="language-text">antd</code>的表格功能太强大, 有很多功能我是用不上, 无形中增加了代码.</li></ul><h4 id="解决方法" class="heading"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95" aria-hidden="true"><span class="icon icon-link"></span></a>解决方法</h4><p>指定表格的<code class="language-text">scrollTarget</code>, 既<code class="language-text">滚动</code>的目标, 默认是<code class="language-text">document.scrollingElement</code>.</p><ul><li>当表头滚动到顶部时, 使用<code class="language-text">transform</code>固定,由于属于同一个<code class="language-text">table</code>, 这样能解决<code class="language-text">tbody</code>和<code class="language-text">thead</code>不对齐的问题.</li><li>固定两侧是通过<code class="language-text">table</code>冗余实现(antd也是如此), 但只会冗余需要固定的部分。通过<code class="language-text">absolute</code> + <code class="language-text">padding</code> 实现两侧固定.</li><li>最后通过不同表格的同一行中的最大高度, 来设定其他表格该行的高度, 来达到高度同步</li><li>由于表格高度超过容器高度, 横向滚动条会被'隐藏', 因此提供了一个<code class="language-text">scroller</code>来模拟横向滚动条, 也就是说任何时候都可以拉动滚动条. (当然也可以通过<code class="language-text">shift</code> + 滚轮完成滚动)</li></ul><h4 id="不足点" class="heading"><a href="#%E4%B8%8D%E8%B6%B3%E7%82%B9" aria-hidden="true"><span class="icon icon-link"></span></a>不足点</h4><ul><li>由于<code class="language-text">thead</code>使用了<code class="language-text">transform</code>, 因此也带来了几个问题<ul><li>当<code class="language-text">thead</code>设了<code class="language-text">transform</code>之后, <code class="language-text">border</code>会失效, 因此使用了<code class="language-text">box-shadow</code>来模拟<code class="language-text">border</code>. 当然,</li></ul></li><li>监听<code class="language-text">mousewheel</code>来设置<code class="language-text">transform</code>的时候, 因为滚动和视图更新有延迟, 在<code class="language-text">firfox</code>和<code class="language-text">safari</code>会有抖动, 在<code class="language-text">chrome</code>下表现良好.<ul><li>在<code class="language-text">chrome</code>和<code class="language-text">firfox</code>分别加入<code class="language-text">window.addEventListener('scroll', console.log)</code>, 鼠标滚动一次, 会发现<code class="language-text">ff</code>下会触发多次回调, 而<code class="language-text">chrome</code>只会触发一次</li></ul></li><li><code class="language-text">safari</code>下, <code class="language-text">thead</code>在被固定后的<code class="language-text">box-shadow</code>会失效.</li></ul><h4 id="使用方式" class="heading"><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F" aria-hidden="true"><span class="icon icon-link"></span></a>使用方式</h4><p>和<code class="language-text">antd</code>类似</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">import { Table } from &#39;@zzwing/react-table&#39;
const data = [{key1: &#39;123&#39;, keyn: &#39;123&#39;}]
const columns = [{
    title: &#39;column1&#39;,
    fixed: &#39;left&#39;,
    dataIndex: &#39;key1&#39;
}, { /* ... */} , {
    title: &#39;column2&#39;,
    fixed: &#39;right&#39;,
    dataIndex: &#39;keyn&#39;
}]

&lt;Table dataSource={data} columns={columns} rowKey=&#39;key1&#39;/&gt;</code></pre></div><p><img src="https://user-gold-cdn.xitu.io/2019/4/1/169d831914e5a110?w=834&#x26;h=794&#x26;f=png&#x26;s=146069"></p><h3 id="react-form-wrapper" class="heading"><a href="#react-form-wrapper" aria-hidden="true"><span class="icon icon-link"></span></a>React-Form-Wrapper</h3><p><a href="https://github.com/zWingz/react-form-wrapper">源码</a> <a href="https://zwing.site/react-form-wrapper/#/">Demo</a></p><p>封装了<code class="language-text">onChange</code>和<code class="language-text">value</code>的高阶组件, 与<code class="language-text">antd</code>的<code class="language-text">form</code>组件类似 不过只包含最基础的数据绑定, 也可通过<code class="language-text">options</code>来自定义数据的读写.</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> FormWrapperHoc <span class="token keyword">from</span> <span class="token string">'@zzwing/react-form-wrapper'</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> itemWrapper<span class="token punctuation">,</span> getState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>formWrapper
    <span class="token keyword">const</span> Input <span class="token operator">=</span> <span class="token function">itemWrapper</span><span class="token punctuation">(</span><span class="token string">'valueKey'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token comment">/* options */</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>valueKey
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>Input<span class="token punctuation">}</span><span class="token plain-text">
        you can get value for </span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><h4 id="链式key的读写实现" class="heading"><a href="#%E9%93%BE%E5%BC%8Fkey%E7%9A%84%E8%AF%BB%E5%86%99%E5%AE%9E%E7%8E%B0" aria-hidden="true"><span class="icon icon-link"></span></a>链式key的读写实现</h4><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">const Input = itemWrapper(&#39;a.b.c.d&#39;)(&lt;input /&gt;)</code></pre></div><p>按照一般实现, 会通过遍历每一层来<code class="language-text">set</code>/<code class="language-text">get</code>数据.</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">const _state = {}
const pathArr = path.split(&#39;.&#39;)
let tmp = _state
pathArr.forEach((each, index) =&gt; {
    if(index === pathArr.length - 1) {
        // do something
    }
    if(each in tmp) {
        tmp = tmp[each]
    } else {
        tmp[each] = {}
        tmp = tmp[each]
    }
})</code></pre></div><p>最近改了一种实现方法, 通过一个<code class="language-text">chain</code>对象直接存储<code class="language-text">path</code>对应的数据 <a href="https://codesandbox.io/s/qzm589k42j?fontsize=14"><img src="https://user-gold-cdn.xitu.io/2019/4/1/169d83173a8c345a?w=201&#x26;h=42&#x26;f=svg&#x26;s=21059" alt="Edit chain object"></a></p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// a.b.c.d</span>
<span class="token keyword">const</span> chain <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token punctuation">{</span> b<span class="token operator">:</span> chain<span class="token punctuation">[</span><span class="token string">'a.b'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'a.b'</span><span class="token operator">:</span> <span class="token punctuation">{</span> c<span class="token operator">:</span> chain<span class="token punctuation">[</span><span class="token string">'a.b.c'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'a.b.c'</span><span class="token operator">:</span> <span class="token punctuation">{</span> d<span class="token operator">:</span> chain<span class="token punctuation">[</span><span class="token string">'a.b.c.d'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'a.b.c.d'</span><span class="token operator">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>对于<code class="language-text">get</code>操作, 则可以直接从<code class="language-text">chain[path]</code>中获取数据</li><li>对于<code class="language-text">set</code>操作, 则可以直接修改<code class="language-text">chain['a.b.c'].d = 'str'</code>, 最后修改<code class="language-text">chain['a.b.c.d'] = 'str</code></li><li>因为修改的是同一个引用, 所以<code class="language-text">set</code>操作会同步<code class="language-text">chain.a</code>和<code class="language-text">chain.a.b</code></li></ul><h3 id="最后" class="heading"><a href="#%E6%9C%80%E5%90%8E" aria-hidden="true"><span class="icon icon-link"></span></a>最后</h3><p><code class="language-text">antd</code>是一个功能很全的UI库 但又正因为它功能很全，而大部分我是不需要，无形中可能添加了不少的代码量 所以我更喜欢是参考<code class="language-text">antd</code>的实现，去开发满足个人需求的组件 自己开发的组件，自己会更清楚，使用起来更加顺手，扩展起来也会很方便 不过对于<code class="language-text">DatePicker</code>这类组件，我想我还是直接用<code class="language-text">antd</code>的吧</p><hr><p>希望这几个组件能帮到你.</p></div><div class="comments"><div id="gitalk-container"></div></div></article></div></div></main><footer class="footer"><div class="center">Powered by <a target="_blank" href="https://github.com/acyortjs/acyort">AcyOrt</a> / Theme <a target="_blank" href="https://github.com/acyortjs/theme-donob">donob</a></div></footer><script src="/script/post.js"></script><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script>const gitalkConfig = JSON.parse('{"owner":"zWingz","repo":"my-blog-config","admin":["zWingz"],"clientID":"0438ed96c0cb944693a7","clientSecret":"23e7aa3152f5d03d8f20029540741d6f886c9f5b","number":30}')
  var gitalk = new Gitalk({
    ...gitalkConfig
  })
  gitalk.render('gitalk-container')</script><script defer="defer" src="/script/ribbon.js"></script></body></html>